{"version":3,"sources":["webpack:///./src/models/order.ts","webpack:///./src/views/Order.vue?f411","webpack:///./src/views/Order.vue?3757","webpack:///./src/views/Order.vue?8174","webpack:///./src/views/Order.vue"],"names":["__webpack_require__","d","__webpack_exports__","PropDesc","orderid","rent","deposit","wifi","trash","water","electricity","total","lastwatercnt","lastelectricitycnt","watercnt","electricitycnt","fromdate","todate","transaction_id","render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_l","key","index","_s","GetPropName","GetPropValue","orderInfo","_e","on","click","$event","onPay","order","room","staticRenderFns","Ordervue_type_script_lang_ts_Order","_super","Order","_this","apply","arguments","loginUser","registerData","orderData","allOrderData","isShowOneOrder","tslib_es6","prototype","mounted","user","$route","query","RequestOrderData","RequestRegisterInfo","openid","host","define","api","vue_property_decorator","axios","get","then","response","data","console","log","code","RequestContractData","contractid","length","encodeURI","join","contractData","orderid_1","forEach","element","one","push","RequestMultiOrderData","prop","o","Object","defineProperty","props","finishedtime","lst","hasOwnProperty","sort","a","b","t1","Date","t2","Ordervue_type_script_lang_ts_","views_Ordervue_type_script_lang_ts_","component","componentNormalizer","options","__file"],"mappings":"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","file":"js/order.ed852e42.js","sourcesContent":["\nexport interface DATA {\n  orderid?: string;\n  room?: number;\n  openid?: string;\n  createdtime?: number;\n  // 费用列表\n  rent?: number;\n  deposit?: number;\n  wifi?: number;\n  trash?: number;\n  water?: number;\n  electricity?: number;\n  total?: number;\n  // 抄表记录\n  lastwatercnt?: number;\n  lastelectricitycnt?: number;\n  watercnt?: number;\n  electricitycnt?: number;\n  fromdate?: string;\n  todate?: string;\n  // 微信支付订单号，如果有则认为已支付\n  transaction_id?: string;\n  finishedtime?: number;\n  [key: string]: any;\n}\n\nexport const PropDesc: { [key: string]: string } = {\n  orderid: '商户订单号',\n  rent: '租金',\n  deposit: '押金',\n  wifi: 'Wi-Fi',\n  trash: '垃圾处理',\n  water: '水费',\n  electricity: '电费',\n  total: '总计',\n  // 抄表记录\n  lastwatercnt: '上期水表',\n  lastelectricitycnt: '上期电表',\n  watercnt: '本期水表',\n  electricitycnt: '本期电表',\n  fromdate: '开始时间',\n  todate: '结束时间',\n  // 微信支付订单号，如果有则认为已支付\n  transaction_id: '微信订单号',\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"Order\"},[(_vm.isShowOneOrder)?_c('div',[_c('div',{staticClass:\"weui-cells__title\"},[_vm._v(\"订单详情\")]),_c('div',{staticClass:\"weui-cells\"},[_vm._l((_vm.showProps),function(key,index){return _c('div',{key:index,staticClass:\"weui-cell\"},[_c('div',{staticClass:\"weui-cell__bd\"},[_c('p',[_vm._v(_vm._s(_vm.GetPropName(key)))])]),_c('div',{staticClass:\"weui-cell__ft\"},[_vm._v(_vm._s(_vm.GetPropValue(key)))])])}),(!_vm.orderInfo.transaction_id)?_c('div',{staticClass:\"weui-btn-area\"},[_c('a',{staticClass:\"weui-btn weui-btn_primary\",on:{\"click\":function($event){_vm.onPay()}}},[_vm._v(\"支付\")])]):_vm._e(),_vm._v(\"Î\\n    \")],2)]):_c('div',[_c('div',{staticClass:\"weui-cells__title\"},[_vm._v(\"历史订单\")]),_c('div',{staticClass:\"weui-cells\"},_vm._l((_vm.sortedOrder),function(order,index){return _c('div',{key:index,staticClass:\"weui-cell\"},[_c('div',{staticClass:\"weui-cell__bd\"},[_c('p',[_vm._v(_vm._s(order.room+order.fromdate))])]),_c('div',{staticClass:\"weui-cell__ft\"},[_vm._v(_vm._s('¥' + order.total))])])}),0)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport { Component, Vue } from 'vue-property-decorator';\nconst weui = require('weui.js');\nimport * as user from '@/models/user';\nimport * as register from '@/models/register';\nimport * as contract from '@/models/contract';\nimport * as order from '@/models/order';\nimport * as define from '@/defines/define';\nimport * as utils from '@/utils/utils';\n\n@Component\nexport default class Order extends Vue {\n  private loginUser: user.User = {};\n  private registerData: register.DATA = {};\n  private orderData: order.DATA = {};\n  private allOrderData: { [key: string]: order.DATA } = {};\n  private isShowOneOrder = false;\n\n  private mounted() {\n    this.loginUser = user.get() as user.User;\n    if (this.$route.query.orderid) {\n      this.isShowOneOrder = true;\n      this.RequestOrderData(this.$route.query.orderid as string);\n    } else {\n      this.isShowOneOrder = false;\n      this.RequestRegisterInfo(this.loginUser.openid);\n    }\n  }\n\n  private RequestOrderData(orderid: string) {\n    if (orderid) {\n      const host = define.API_HOST;\n      const api = host + '/sunnyhouse/orderid?orderid=' + orderid;\n      Vue.axios.get(api).then((response) => {\n        const data = response.data;\n        console.log('OrderInfo', data);\n        if (data && data.code === 'SUCCESS') {\n          this.orderData = data.data as order.DATA;\n        }\n      });\n    }\n  }\n\n  private RequestRegisterInfo(openid?: string) {\n    const host = define.API_HOST;\n    const api = host + '/sunnyhouse/register?openid=' + openid;\n    Vue.axios.get(api).then((response) => {\n      const data = response.data;\n      console.log('RegisterInfo', data);\n      if (data && data.code === 'SUCCESS') {\n        this.registerData = data.data as register.DATA;\n        this.RequestContractData();\n      }\n    });\n  }\n\n  private RequestContractData() {\n    const contractid = this.registerData.contractid;\n    if (contractid && contractid.length > 0) {\n      const host = define.API_HOST;\n      const api = host + '/sunnyhouse/contract?mutli=1&contractid=' + encodeURI(contractid.join(','));\n      Vue.axios.get(api).then((response) => {\n        const data = response.data;\n        console.log('ContractData', data);\n        if (data && data.code === 'SUCCESS') {\n          const contractData = data.data as contract.DATA[];\n          if (contractData) {\n            const orderid: string[] = [];\n            contractData.forEach((element) => {\n              if (element.orderid) {\n                element.orderid.forEach((one) => {\n                  orderid.push(one);\n                });\n              }\n            });\n            this.RequestMultiOrderData(orderid);\n          }\n        }\n      });\n    }\n  }\n\n  private RequestMultiOrderData(orderid: string[]) {\n    const host = define.API_HOST;\n    if (orderid && orderid.length > 0) {\n      const api = host + '/sunnyhouse/order?mutli=1&orderid=' + encodeURI(orderid.join(','));\n      Vue.axios.get(api).then((response) => {\n        const data = response.data;\n        console.log('OrderData', data);\n        if (data && data.code === 'SUCCESS') {\n          const orderData = data.data as order.DATA[];\n          if (orderData) {\n            orderData.forEach((element) => {\n              this.allOrderData[element.orderid as string] = element;\n            });\n          }\n        }\n      });\n    }\n  }\n\n  private GetPropName(prop: string) {\n    return order.PropDesc[prop];\n  }\n\n  private GetPropValue(prop: string) {\n    const o = this.orderData;\n    if (prop === 'water') {\n      return `(${o.lastwatercnt}-${o.watercnt})*2.5=${o.water}`;\n    } else if (prop === 'electricity') {\n      return `(${o.lastelectricitycnt}-${o.electricitycnt})*2.5=${o.electricity}`;\n    } else {\n      return this.orderData[prop];\n    }\n  }\n\n  private onPay() {\n    if (this.orderData.orderid) {\n      console.log('开始支付->', this.orderData.orderid);\n    }\n  }\n\n  get showProps() {\n    const props = ['orderid', 'createdtime',\n      'rent', 'deposit', 'wifi', 'trash', 'water', 'electricity', 'total',\n      'lastwatercnt', 'lastelectricitycnt', 'watercnt', 'electricitycnt',\n      'fromdate', 'todate', 'transaction_id'];\n    if (this.orderData.finishedtime) {\n      props.push('finishedtime');\n    }\n    return props;\n  }\n\n  get sortedOrder() {\n    const lst: order.DATA[] = [];\n    for (const key in this.allOrderData) {\n      if (this.allOrderData.hasOwnProperty(key)) {\n        const element = this.allOrderData[key];\n        lst.push(element);\n      }\n    }\n    lst.sort((a, b) => {\n      const t1 = new Date(a.fromdate as string);\n      const t2 = new Date(b.fromdate as string);\n      return t1 > t2 ? 1 : -1;\n    });\n    return lst;\n  }\n}\n\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??ref--12-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Order.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/ts-loader/index.js??ref--12-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Order.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Order.vue?vue&type=template&id=3b9268a4&\"\nimport script from \"./Order.vue?vue&type=script&lang=ts&\"\nexport * from \"./Order.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Order.vue\"\nexport default component.exports"],"sourceRoot":""}